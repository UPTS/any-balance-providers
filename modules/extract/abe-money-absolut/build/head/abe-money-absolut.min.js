var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36"},g_Xml_Headers={Accept:"application/xml, text/xml, */*; q=0.01","X-Requested-With":"XMLHttpRequest","Wicket-Ajax":"true","Wicket-Ajax-BaseURL":"main","Wicket-FocusedElementId":"id19",Origin:"https://online.absolutbank.ru"},baseurl="https://online.absolutbank.ru/app/";
function login(a,c){AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");var b=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту провайдера! Попробуйте обновить данные позже.");if(!/logout/i.test(b)){var d=findWicketActions(b),e=[],f=getParam(b,null,null,/<input[^>]*name="password"[^>]*id="([^"]+)/i),h=getParam(b,
null,null,/<input[^>]*name="login"[^>]*id="([^"]+)/i),k=getParam(b,null,null,/<a[^>]*class="button[^>]*id="([^"]+)/i);d.forEach(function(a,b,c){a=getJson(a);b=(a.u||"").replace(/^.\/main/,"main").replace(/;jsessionid[^?]+/i,"");switch(a.c){case h:e[0]=b;break;case f:e[1]=b;break;case k:e[2]=b}});d=[{login:a.login},{password:a.password}];d[2]=joinObjects(d[0],d[1]);for(var g=0;g<e.length;g++)b=AnyBalance.requestPost(baseurl+e[g],d[g],addHeaders(g_Xml_Headers));if(!/logout/i.test(b)){if(d=AB.getParam(b,
null,null,/"feedbackPanelERROR"[^>]*>([\s\S]*?)<\//i,AB.replaceTagsAndSpaces))throw new AnyBalance.Error(d,null,/Неверно указан/i.test(d));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в личный кабинет. Сайт изменен?");}__setLoginSuccessful()}return b}
function processProfile(a,c){isAvailable("profile")&&(a=requestGetWicketAction(a,/<span[^>]+class="link" id="(id[^"]+)/i),c.profile={},getParam(a,c.profile,"profile.fio",/ФИО((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces),getParam(a,c.profile,"profile.birthday",/Дата рождения((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces),getParam(a,c.profile,"profile.phone",/Телефон((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces),getParam(a,c.profile,"profile.adress",/Адрес регистрации((?:[\s\S]*?<\/div[^>]*>){2})/i,
replaceTagsAndSpaces),getParam(a,c.profile,"profile.adressHome",/Домашний адрес((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces))}function findWicketActions(a){a=sumParam(a,null,null,/Wicket.Ajax.ajax\((\{[\s\S]*?\})\);/ig)||[];AnyBalance.trace("Found "+a.length+" Wicket-ajax actions");return a}function findExactWickeAction(a,c){if(a)for(var b=0;b<a.length;b++){var d=getJson(a[b]),e=(d.u||"").replace(/^.\/main/,"main").replace(/;jsessionid[^?]+/i,"");if(d.c===c)return e}}
function requestGetWicketAction(a,c){var b=getParam(a,null,null,c);if(!b)throw new AnyBalance.Error("Не нашли wicketId!");var d=findWicketActions(a),b=findExactWickeAction(d,b);return AnyBalance.requestGet(baseurl+b+"&_="+(new Date).getTime(),addHeaders(g_Xml_Headers))}
function checkForRedirect(a){/<redirect>/i.test(a)&&((a=getParam(a,null,null,/main;[^\]]+/i))||AnyBalance.trace("Запрошен редиретк, но ссылка на него не найдена, сайт изменен?"),a=AnyBalance.requestGet(baseurl+a,g_headers));return a}
function processCards(a,c){if(isAvailable("cards")){a=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);a=requestGetWicketAction(a,/<div[^>]+class="inner"[^>]+id="(id[^"]+)"/i);var b=getElements(a,/<div[^>]+class=['"]card inner['"][^>]*>/ig);AnyBalance.trace("Найдено карт: "+b.length);c.cards=[];for(var d=0;d<b.length;++d){var e=getParam(b[d],null,null,/<small[^>]+class="gray"[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces),f=getParam(b[d],null,null,/"card-name"[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces),
e={__id:e,__name:f+" "+e};__shouldProcess("cards",e)&&processCard(b[d],e,a);c.cards.push(e)}}}
function processCard(a,c,b){getParam(a,c,"cards.balance",/class="amount"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,["cards.currency","cards"],/class="amount"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);b=requestGetWicketAction(b,/<div[^>]+class="card inner"[^>]+id="(id[^"]+)"/i);getParam(b,c,"cards.limit",/Кредитный лимит((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.debt",/Общая задолженность((?:[\s\S]*?<\/div[^>]*>){2})/i,
replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.ovedraft",/Текущий овердрафт((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.ovedraft_pcts",/Сумма начисленных процентов по овердрафту((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.ovedraft_overdue",/Просроченный овердрафт((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.overlimit",/Сверхлимитная задолженность((?:[\s\S]*?<\/div[^>]*>){2})/i,
replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.commissions",/Cумма комиссий((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.penalty",/Сумма штрафов((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.billing_date",/Расчетная дата((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.minpay",/Минимальный платеж((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(b,
c,"cards.minpay_overdue",/в том числе просроченные минимальные платежи((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"cards.till",/Срок действия((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseDate);getParam(b,c,"cards.holderName",/Имя владельца((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces);getParam(b,c,"cards.status",/Статус карты((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces);"undefined"!=typeof processCardTransactions&&processCardTransactions(b,
c)}
function processAccounts(a,c){if(isAvailable("accounts")){a=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);a=requestGetWicketAction(a,/<div[^>]+class="inner"[^>]+id="(id[^"]+)"/i);var b=getElements(a,/<div[^>]+class=['"]account inner single-account['"][^>]*>/ig);AnyBalance.trace("Найдено счетов: "+b.length);c.accounts=[];for(var d=0;d<b.length;++d){var e=requestGetWicketAction(b[d]+a,/id="(id[^"]+)"/i),f={__id:getParam(e,null,null,/№(?:[^>]*>)?(\d{20})/i,replaceTagsAndSpaces),__name:getParam(e,null,
null,/class="dashed active"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces)};__shouldProcess("accounts",f)&&processAccount(e,f);c.accounts.push(f)}}}
function processAccount(a,c){getParam(a,c,"accounts.balance",/class="[^"]*amounts"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,["accounts.currency","accounts"],/class="[^"]*amounts"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);"undefined"!=typeof processAccountTransactions&&processAccountTransactions(a,c)};
